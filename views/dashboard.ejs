<!DOCTYPE html>
<html>
	<head>
		<% include shims/head.ejs %>
	</head>
	<body>
		<% include shims/header.ejs %>
		<main>
			<div class="container">
				<div class="row">
					<div class="col s12">
						<br>
						<ul id="tabs-swipe-demo" class="tabs">
							<li class="tab col s3"><a class="active" href="#test-swipe-1">detect</a></li>
							<li class="tab col s3"><a href="#test-swipe-2">generate</a></li>
						</ul>
						<div id="test-swipe-1" class="col s12">
							<div class="row">
								<div class="col s6">
									<div id="my_camera" style="width:320px; height:240px;"></div>
					    			<a href="javascript:void(take_snapshot())" class="waves-effect waves-light btn col s5 red"><i class="material-icons">camera_alt</i></a>
								</div>
								<div class="col s6">
									<div id="my_result" style="width:320px; height:240px;">CAPTURED IMAGE WILL BE SHOWN HERE</div>	
					    			<a href="javascript:void(send_image())" class="waves-effect waves-light btn col s5 blue">Upload<i class="material-icons right">send</i></a>
								</div>
							</div>			    
						</div>
						<div id="test-swipe-2" class="col s12">
							<div class="col s2"></div>
							<div class="col s8">
								<p class="flow-text">Please enter you dataset in the form of a compressed zip file</p>
								<form encType="multipart/form-data" action="/handleDataset" method="POST" class="file-field input-field">
									<input id="dataset_type" type="text" hidden="true" name="type" value="102">
									<div class="btn red">
										<span>File</span>
										<input name="file" id="file" type="file">
									</div>
									<div class="file-path-wrapper">
										<input class="file-path validate" type="text">
									</div>
									<button class="btn waves-effect waves-light" type="submit" name="action">Submit
									    <i class="material-icons right">send</i>
								  	</button>
								</form>
							</div>
						</div>
					</div>
				</div>
				
				
			</div>
		</main>
		<% include shims/footer.ejs %>
		<!--JavaScript at end of body for optimized loading-->
		<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
		<script type="text/javascript" src="js/materialize.min.js"></script>
		<script type="text/javascript" src="js/webcam.min.js"></script>
	    <script language="JavaScript">
	        Webcam.attach( '#my_camera' );
	        Webcam.set({
		        width: 320,
		        height: 240,
		        dest_width: 640,
		        dest_height: 480,
		        image_format: 'jpeg',
		        jpeg_quality: 100,
		        force_flash: false,
		        flip_horiz: true,
		        fps: 45
		    });
	        function take_snapshot() {
	            Webcam.snap( function(data_uri) {
	            	raw_image_data = data_uri.replace(/^data\:image\/\w+\;base64\,/, '');
	                document.getElementById('my_result').innerHTML = '<img width="320" height="240" src="'+data_uri+'"/>';
	            } );
	        }
	        function send_image() {
	        	$.ajax({
	                url: "/request",
	                type: "post",
	                data: { image: raw_image_data, type: 101, person_id: $("#person_id").val() },
	                success: function(result) {
	                	console.log(result);
	                }
	            });
	        }

	        function send_dataset() {
	        	$('form').submit();
				// var fd = new FormData();   
	 			// 	fd.append( 'file', $('#file')[0].files );
	 			// 	$.ajax({
	 			// 		url: '/request',
				 //        type: "POST",
				 //        enctype: 'multipart/form-data',
				 //        processData: false,  // Important!
				 //        contentType: false,
				 //        cache: false,
				 //        data: fd,
				 //        success: function(data){
				//         console.log(data);
				//     }
				// });

	        }
	    </script> 
	    <script type="text/javascript">
	    	$(document).ready(function(){
	    		<% if( loaded ) { %>
	    			Materialize.toast("dataset loaded successfully");
	    		<% } else { %>
	    			Materialize.toast("no dataset found");
	    		<% } %>
	    	});
	    </script>
   	</body>
</html>